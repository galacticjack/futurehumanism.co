const BEEHIIV_FORM_ID="c7d45ea8-9b86-4677-8bd0-9e3b37e0b1c7";async function syncToBeehiiv(e){try{const s=new FormData;s.append("email",e),await fetch(`https://app.beehiiv.com/forms/${BEEHIIV_FORM_ID}/subscribe`,{method:"POST",body:s,mode:"no-cors"})}catch(e){console.warn("Beehiiv sync failed:",e)}}async function handleSubscribe(e,s="unknown",t=["newsletter"]){const r=window.getSupabase?.();if(syncToBeehiiv(e),!r)return{success:!0,message:"You're in! Check your inbox."};try{const{error:o}=await r.from("subscribers").insert({email:e,source:s,tags:t,metadata:{page:window.location.pathname,referrer:document.referrer||null,timestamp:(new Date).toISOString()}});return"23505"===o?.code?{success:!0,message:"You're already subscribed!"}:o?(console.error("Subscribe error:",o),{success:!0,message:"You're in! Check your inbox."}):{success:!0,message:"You're in! Check your inbox."}}catch(e){return console.error("Subscribe error:",e),{success:!0,message:"You're in! Check your inbox."}}}function setupSubscribeForms(){document.querySelectorAll("form[data-source], .newsletter-cta__form, #subscribeBarForm, .sticky-form, .subscribe-form").forEach(e=>{e.action&&e.action.includes("beehiiv")||e.addEventListener("submit",async s=>{s.preventDefault();const t=e.querySelector('input[type="email"]'),r=e.querySelector('button[type="submit"]'),o=t?.value?.trim();if(!o)return;let c=e.dataset.source||e.id||"unknown";e.closest(".sticky-bar")&&(c="sticky_bar"),e.closest(".newsletter-cta")&&(c="inline_article"),e.closest(".footer")&&(c="footer_cta"),e.closest(".header")&&(c="header_cta"),e.closest(".subscribe-hero")&&(c="subscribe_page");const n=r.textContent;r.disabled=!0,r.textContent="Subscribing...";const i=await handleSubscribe(o,c);r.textContent=i.success?"âœ“ Subscribed!":"Try Again",i.success?(t.value="",setTimeout(()=>{r.textContent=n,r.disabled=!1},3e3)):(r.disabled=!1,r.textContent=n)})})}document.addEventListener("DOMContentLoaded",setupSubscribeForms),window.handleSubscribe=handleSubscribe;